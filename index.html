
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- Optimized viewport for mobile - prevents zoom issues and ensures proper scaling -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover" />
    
    <!-- Mobile-specific optimizations -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="theme-color" content="#2563eb" />
    <meta name="apple-mobile-web-app-title" content="Funding For Scotland" />
    
    <!-- Favicon -->
    <link rel="icon" href="/lovable-uploads/beb68662-b15e-4c22-bae2-7be4c6bb42e7.png" type="image/png">
    
    <!-- Critical resource hints for fastest loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Load Google Fonts stylesheet immediately with proper font-display -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" media="print" onload="this.media='all'; this.onload=null;">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"></noscript>
    
    <!-- Only preload the actual ECO4 hero image used immediately -->
    <link rel="preload" as="image" href="/lovable-uploads/1932c2a7-9b3e-46a2-8e62-d0fabe9d2ade.png" fetchpriority="high" media="(min-width: 1px)">
    
    <!-- Inline ECO4 critical CSS for immediate hero rendering -->
    <style>
      /* COMPLETE Critical CSS - ALL navigation classes included */
      *{box-sizing:border-box;margin:0;padding:0}
      html{font-family:'Inter',system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;font-display:swap;scroll-behavior:smooth;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}
      body{background:#ffffff;color:#1a1a1a;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;line-height:1.6;touch-action:manipulation}
      
      /* COMPLETE Navigation CSS */
      nav{background-color:#ffffff;box-shadow:0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05);position:sticky;top:0;z-index:50}
      .bg-white{background-color:#ffffff}
      .shadow-lg{box-shadow:0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05)}
      .sticky{position:sticky}
      .top-0{top:0}
      .z-50{z-index:50}
      .max-w-7xl{max-width:80rem}
      .mx-auto{margin-left:auto;margin-right:auto}
      .px-3{padding-left:0.75rem;padding-right:0.75rem}
      .px-4{padding-left:1rem;padding-right:1rem}
      .flex{display:flex}
      .justify-between{justify-content:space-between}
      .items-center{align-items:center}
      .h-14{height:3.5rem}
      .h-16{height:4rem}
      .h-6{height:1.5rem}
      .h-8{height:2rem}
      .h-10{height:2.5rem}
      .w-auto{width:auto}
      .object-contain{object-fit:contain}
      .hidden{display:none}
      .ml-10{margin-left:2.5rem}
      .items-baseline{align-items:baseline}
      .space-x-2>:not([hidden])~:not([hidden]){margin-left:0.5rem}
      .px-2{padding-left:0.5rem;padding-right:0.5rem}
      .py-2{padding-top:0.5rem;padding-bottom:0.5rem}
      .rounded-md{border-radius:0.375rem}
      .text-sm{font-size:0.875rem;line-height:1.25rem}
      .font-medium{font-weight:500}
      .text-center{text-align:center}
      .transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(0.4,0,0.2,1);transition-duration:150ms}
      .text-gray-700{color:#374151}
      .text-white{color:#ffffff}
      .bg-blue-600{background-color:#2563eb}
      .hover\:bg-blue-50:hover{background-color:#eff6ff}
      .hover\:text-blue-600:hover{color:#2563eb}
      .inline-flex{display:inline-flex}
      .justify-center{justify-content:center}
      .p-3{padding:0.75rem}
      .hover\:bg-gray-100:hover{background-color:#f3f4f6}
      .touch-manipulation{touch-action:manipulation}
      .pt-2{padding-top:0.5rem}
      .pb-3{padding-bottom:0.75rem}
      .space-y-1>:not([hidden])~:not([hidden]){margin-top:0.25rem}
      .border-t{border-top-width:1px;border-color:#e5e7eb}
      .block{display:block}
      .py-4{padding-top:1rem;padding-bottom:1rem}
      .text-base{font-size:1rem;line-height:1.5rem}
      
      /* Responsive classes */
      @media (min-width: 640px) {
        .sm\:px-4{padding-left:1rem;padding-right:1rem}
        .sm\:h-16{height:4rem}
        .sm\:h-8{height:2rem}
      }
      @media (min-width: 1024px) {
        .lg\:px-8{padding-left:2rem;padding-right:2rem}
        .lg\:block{display:block}
        .lg\:hidden{display:none}
        .lg\:h-10{height:2.5rem}
      }
      @media (min-width: 1280px) {
        .xl\:px-3{padding-left:0.75rem;padding-right:0.75rem}
        .xl\:space-x-4>:not([hidden])~:not([hidden]){margin-left:1rem}
      }
      
      /* Essential layout classes */
      .relative{position:relative}
      .min-h-screen{min-height:100vh}
      .flex-col{flex-direction:column}
      .flex-1{flex:1 1 0%}
      
      /* Additional critical styles for other components */
      .bg-gray-50{background-color:#f9fafb}
      .animate-pulse{animation:pulse 2s cubic-bezier(0.4,0,0.6,1) infinite}
      .bg-gray-300{background-color:#d1d5db}
      .bg-gray-200{background-color:#e5e7eb}
      .rounded{border-radius:0.25rem}
      .mb-4{margin-bottom:1rem}
      .w-48{width:12rem}
      .w-32{width:8rem}
      .h-4{height:1rem}
      .inline-block{display:inline-block}
      @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
    </style>
    
    <!-- Defer all non-critical CSS until after hero renders -->
    <link rel="preload" as="style" href="/src/index.css" onload="this.onload=null;this.rel='stylesheet'" media="print">
    <noscript><link rel="stylesheet" href="/src/index.css"></noscript>
    
    <!-- Load ECO4 specific styles after critical path -->
    <link rel="preload" as="style" href="/src/styles/critical-eco4.css" onload="this.onload=null;this.rel='stylesheet'" media="print">
    <noscript><link rel="stylesheet" href="/src/styles/critical-eco4.css"></noscript>

    <!-- EMERGENCY PIXEL CLEANUP - NUCLEAR OPTION -->
    <script>
      // üö® EMERGENCY: Stop ALL pixel activity and restart clean
      console.log('üî• EMERGENCY CLEANUP: Nuking all pixel state...');
      
      // Kill everything pixel-related
      if (window.fbq) {
        console.log('üóëÔ∏è REMOVING: Existing fbq found, destroying...');
        delete window.fbq;
      }
      if (window._fbq) {
        console.log('üóëÔ∏è REMOVING: Existing _fbq found, destroying...');
        delete window._fbq;
      }
      
      // Remove all existing pixel scripts from DOM
      const existingScripts = document.querySelectorAll('script[src*="fbevents.js"]');
      existingScripts.forEach(script => {
        console.log('üóëÔ∏è REMOVING: Existing fbevents script from DOM');
        script.remove();
      });
      
      // Remove any tracking pixels in noscript tags
      const existingNoscripts = document.querySelectorAll('noscript img[src*="facebook.com/tr"]');
      existingNoscripts.forEach(img => {
        console.log('üóëÔ∏è REMOVING: Existing noscript pixel');
        img.remove();
      });
      
      // Clean slate - initialize ONLY our pixel
      !function(f,b,e,v,n,t,s)
      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
      n.callMethod.apply(n,arguments):n.queue.push(arguments)};
      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
      n.queue=[];t=b.createElement(e);t.async=!0;
      t.src=v;s=b.getElementsByTagName(e)[0];
      s.parentNode.insertBefore(t,s)}(window, document,'script',
      'https://connect.facebook.net/en_US/fbevents.js');
      
      // Initialize with the CORRECT literal ID (not variable)
      fbq('init', '1423013825182147');
      console.log('‚úÖ EMERGENCY: Clean pixel initialized with ID 1423013825182147');
      
      // Track PageView ONCE
      fbq('track', 'PageView');
      console.log('‚úÖ EMERGENCY: Single PageView tracked');
      
      // Lock it down permanently
      window._PIXEL_EMERGENCY_LOCKED = true;
    </script>
    
  </head>

  <body class="loading">
    <!-- Facebook Pixel noscript fallback - Required for Meta Pixel Helper detection -->
    <noscript>
      <img height="1" width="1" style="display:none" 
           src="https://www.facebook.com/tr?id=1423013825182147&ev=PageView&noscript=1"/>
    </noscript>
    
    <!-- Immediate critical path script -->
    <script>
      // Mark DOM ready and start paint immediately
      document.addEventListener('DOMContentLoaded', function() {
        document.body.className = 'loaded';
        
        // Intelligent resource prefetching after critical rendering
        if ('requestIdleCallback' in window) {
          requestIdleCallback(function() {
            prefetchLikelyResources();
          });
        } else {
          setTimeout(prefetchLikelyResources, 2000);
        }
      });
      
      // Prefetch strategy for likely next navigations from ECO4
      function prefetchLikelyResources() {
        const likelyPages = [
          { path: '/solar', priority: 'high' },
          { path: '/gas-boilers', priority: 'high' },
          { path: '/home-improvements', priority: 'medium' },
          { path: '/contact', priority: 'low' }
        ];
        
        // Prefetch likely page routes
        likelyPages.forEach(page => {
          const link = document.createElement('link');
          link.rel = 'prefetch';
          link.href = page.path;
          link.fetchPriority = page.priority;
          document.head.appendChild(link);
        });
        
        // Only prefetch images after user interaction or significant delay
        const prefetchImages = () => {
          const likelyImages = [
            '/lovable-uploads/597dfb86-407d-45a4-8ed9-bab0b1657c04.png', // Gas boilers
            '/lovable-uploads/29502115-60f2-411e-928e-8d3f6c3383c7.png'  // Home improvements
          ];
          
          likelyImages.forEach((src, index) => {
            setTimeout(() => {
              const link = document.createElement('link');
              link.rel = 'prefetch';
              link.as = 'image';
              link.href = src;
              link.fetchPriority = 'low';
              document.head.appendChild(link);
            }, index * 1000); // Longer delay to avoid preload warnings
          });
        };
        
        // Only prefetch after significant user interaction or delay
        let interacted = false;
        const handleInteraction = () => {
          if (!interacted) {
            interacted = true;
            setTimeout(prefetchImages, 2000);
          }
        };
        
        // Wait for user interaction before prefetching
        ['click', 'scroll', 'keydown', 'touchstart'].forEach(event => {
          document.addEventListener(event, handleInteraction, { once: true, passive: true });
        });
        
        // Fallback: prefetch after 10 seconds if no interaction
        setTimeout(() => {
          if (!interacted) prefetchImages();
        }, 10000);
        
        // Preconnect to form submission domains
        const formDomains = ['https://script.google.com', 'https://hooks.zapier.com'];
        formDomains.forEach(domain => {
          const link = document.createElement('link');
          link.rel = 'preconnect';
          link.href = domain;
          link.crossOrigin = 'anonymous';
          document.head.appendChild(link);
        });
      }
      
      // Performance mark for critical rendering
      if ('performance' in window && 'mark' in performance) {
        performance.mark('critical-css-loaded');
      }
    </script>
    
    
    <div id="root"></div>
    
    <!-- Load main app script immediately for critical rendering -->
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- Critical Script to ensure React Navigation loads immediately -->
    <script>
      // Hide HTML fallback nav when React loads and show React navigation
      document.addEventListener('DOMContentLoaded', function() {
        // Mark that React is loading
        document.body.classList.add('react-loading');
        
        // Set up a minimal navigation fallback while React loads
        const rootDiv = document.getElementById('root');
        if (rootDiv && !rootDiv.hasChildNodes()) {
          rootDiv.innerHTML = `
            <div class="min-h-screen flex flex-col">
              <nav class="bg-white shadow-lg sticky top-0 z-50">
                <div class="max-w-7xl mx-auto px-4">
                  <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                      <a href="/" class="flex items-center">
                        <img 
                          src="/lovable-uploads/530a44a7-5098-4326-9fc0-fb553bdd9052.png" 
                          alt="Funding For Scotland Logo" 
                          class="h-8 w-auto object-contain"
                          width="140"
                          height="56"
                        />
                      </a>
                    </div>
                    <div class="hidden lg:block">
                      <div class="flex space-x-4">
                        <a href="/" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-blue-600">Home</a>
                        <a href="/eco4" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-blue-600">ECO4</a>
                        <a href="/solar" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-blue-600">Solar</a>
                        <a href="/gas-boilers" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-blue-600">Gas Boilers</a>
                        <a href="/home-improvements" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-blue-600">Home Improvements</a>
                        <a href="/contact" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-blue-600">Contact</a>
                      </div>
                    </div>
                  </div>
                </div>
              </nav>
              <main class="flex-1 flex items-center justify-center bg-gray-50">
                <div class="text-center">
                  <div class="animate-pulse">
                    <div class="h-8 bg-gray-300 rounded w-48 mx-auto mb-4"></div>
                    <div class="h-4 bg-gray-200 rounded w-32 mx-auto"></div>
                  </div>
                </div>
              </main>
            </div>
          `;
        }
      });
    </script>
  </body>
</html>
